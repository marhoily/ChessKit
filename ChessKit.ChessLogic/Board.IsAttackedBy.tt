<#@ template debug="true" hostSpecific="true" #>
<#@ output extension=".cs" #>
<#@ Assembly Name="System.Core" #>
<#@ Assembly Name="$(ProjectDir)bin\Debug\ChessKit.ChessLogic.dll" #>
<#@ import namespace="ChessKit.ChessLogic.Enums" #>
<#@ import namespace="ChessKit.ChessLogic.Internals" #>
using ChessKit.ChessLogic.Enums;

namespace ChessKit.ChessLogic
{
    partial class Board
    {
<#
foreach (var color in new []{Color.White, Color.Black})
{
#>
        private bool IsAttackedBy<#=color#>(int cell)
        {
<#
    foreach (var p in MetaPiece.All) 
        if (p.Color == color)
            foreach (var dir in p.MoveDirections)
                if (dir.CapturesThisWay)
            {
                var delta = dir.DeltaY * 16 + dir.DeltaX;
                if (dir.Count > 1)
                {
#>
            for (var i = cell + <#=delta#>; (i & 0x88) == 0; i += <#=delta#>)
            {
                var piece = _cells[i];
                if (piece == 0) continue;
                if (piece == (byte) Piece.<#=p.Color#><#=p.PieceType#>) return true;
                break;
            }
<#
        }
        else
        {
#>
            {
                var square = cell - <#=delta#>;
                if ((square & 0x88) == 0)
                    if (_cells[square] == (byte) Piece.<#=p.Color#><#=p.PieceType#>)
                        return true;
            }
<#
        }
    }
#>
            return false;
        }
<#
}
#>
    }
}